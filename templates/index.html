{% extends 'base.html' %}

{% block title %}Health Wealth & Happiness{% endblock %}

{% block content %}
  <header class="site-hero">
    <div class="container site-title">
      <div>
        <h1>Health Wealth & Happiness</h1>
        <p class="site-sub">Thoughtful posts about wealth, health and happiness â€” concise, well-sourced, and practical.</p>
        <div class="hero-cta">
          <a class="btn btn-primary" href="{{ url_for('explore') }}">Explore Posts</a>
        </div>
      </div>
    </div>
  </header>

  <section class="container">
    <div class="featured-row">
      <div class="featured-main card">
        {% set featured = (wealth_posts|first) or (health_posts|first) or (happiness_posts|first) %}
        {% if featured %}
          <h2>{{ featured.title }}</h2>
          <p class="muted">{{ featured.created_at.strftime('%Y-%m-%d') }} â€” {{ featured.category|title if featured.category }}</p>
          {% if featured.summary %}
            <p>{{ featured.summary }}</p>
          {% else %}
            <p>{{ featured.content[:150] }}{% if featured.content|length > 150 %}...{% endif %}</p>
          {% endif %}
          <p><a class="btn btn-primary" href="{{ url_for('post_view', post_id=featured.id) }}">Read full post</a></p>
        {% else %}
          <h2>No posts yet</h2>
          <p class="muted">There are no posts published yet. Check back soon or add one from the dashboard.</p>
        {% endif %}
      </div>

      <aside class="featured-side">
        <div class="card">
          <h2 class="cat-wealth">Wealth</h2>
          <ul>
          {% for post in wealth_posts %}
            <li>
              <a href="{{ url_for('post_view', post_id=post.id) }}">{{ post.title }}</a>
              <div class="meta">{{ post.created_at.strftime('%Y-%m-%d') }}</div>
              {% if post.summary %}
                <div class="summary">{{ post.summary }}</div>
              {% endif %}
            </li>
          {% else %}
            <li>No posts in this category yet.</li>
          {% endfor %}
          </ul>
        </div>

        <div class="card">
          <h2 class="cat-health">Health</h2>
          <ul>
          {% for post in health_posts %}
            <li>
              <a href="{{ url_for('post_view', post_id=post.id) }}">{{ post.title }}</a>
              <div class="meta">{{ post.created_at.strftime('%Y-%m-%d') }}</div>
              {% if post.summary %}
                <div class="summary">{{ post.summary }}</div>
              {% endif %}
            </li>
          {% else %}
            <li>No posts in this category yet.</li>
          {% endfor %}
          </ul>
        </div>
      </aside>
    </div>

    <div class="grid">
      <div class="card">
        <h2 class="cat-happiness">Happiness</h2>
        <ul>
        {% for post in happiness_posts %}
          <li>
            <a href="{{ url_for('post_view', post_id=post.id) }}">{{ post.title }}</a>
            <div class="meta">{{ post.created_at.strftime('%Y-%m-%d') }}</div>
            {% if post.summary %}
              <div class="summary">{{ post.summary }}</div>
            {% endif %}
          </li>
        {% else %}
          <li>No posts in this category yet.</li>
        {% endfor %}
        </ul>
      </div>

      <div class="card">
        <h2>Stay Connected</h2>
        <p class="muted">Join our community and never miss a thoughtful post about living a balanced life.</p>
        
        {% if not current_user.is_authenticated %}
          <!-- Newsletter Subscription Widget for Guests -->
          <div style="background: var(--hover-bg); padding: 1.5rem; border-radius: var(--radius-sm); border: 1px solid var(--paper-border); margin: 1rem 0;">
            <h4 style="margin: 0 0 0.5rem 0; color: var(--accent); font-size: 1rem;">ðŸ“§ Newsletter</h4>
            <p style="margin: 0 0 1rem 0; font-size: 0.9rem; color: var(--muted);">Get weekly insights delivered to your inbox</p>
            <a href="{{ url_for('newsletter_subscribe') }}" class="btn btn-primary" style="width: 100%; justify-content: center;">
              Subscribe Now
            </a>
          </div>
          
          <!-- RSS Feed Option -->
          <div style="text-align: center; margin-top: 1rem;">
            <p style="font-size: 0.8rem; color: var(--muted); margin-bottom: 0.5rem;">Prefer RSS?</p>
            <a href="{{ url_for('rss_feed') }}" style="color: var(--accent); text-decoration: none; font-size: 0.9rem;">
              ðŸ“¡ Subscribe to RSS Feed
            </a>
          </div>
        {% else %}
          <!-- Developer View -->
          <p><a class="btn btn-outline" href="{{ url_for('dashboard') }}">ðŸ“Š Go to Dashboard</a></p>
        {% endif %}
      </div>

      <div class="card">
        <h2>About This Blog</h2>
        <p class="muted">Smileys Blog is a curated collection of essays and practical tips on living a balanced life. Each post is concise, well-researched, and designed to provide actionable insights.</p>
        <div style="margin-top: 1rem;">
          <a href="{{ url_for('about') }}" style="color: var(--accent); text-decoration: none; font-weight: 500;">
            Learn more about the author â†’
          </a>
        </div>
      </div>
    </div>
  </section>
{% endblock %}