{% extends "base.html" %}

{% block title %}Subscribe to Newsletter{% endblock %}

{% block content %}
<div class="newsletter-subscribe-page">
    <div class="newsletter-header">
        <h1>Subscribe to Our Newsletter</h1>
        <p class="newsletter-description">
            Get the latest posts about wealth, health, and happiness delivered to your inbox.
        </p>
    </div>
    
    <div class="newsletter-form-container">
        <form method="POST" class="newsletter-form">
            {{ form.hidden_tag() }}
            
            <div class="form-group">
                {{ form.email.label(class="form-label") }}
                {{ form.email(class="form-input", placeholder="Enter your email address") }}
                {% if form.email.errors %}
                    <div class="form-errors">
                        {% for error in form.email.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                {{ form.frequency.label(class="form-label") }}
                {{ form.frequency(class="form-select") }}
                <small class="form-help">Choose how often you'd like to receive our digest.</small>
                {% if form.frequency.errors %}
                    <div class="form-errors">
                        {% for error in form.frequency.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <button type="submit" class="btn btn-primary newsletter-submit">
                Subscribe to Newsletter
            </button>
        </form>
        
        <div class="newsletter-info">
            <h3>What to Expect</h3>
            <ul>
                <li>Curated content about wealth building, health optimization, and happiness</li>
                <li>No spam - only quality content delivered at your chosen frequency</li>
                <li>Easy unsubscribe option in every email</li>
                <li>Your email is never shared with third parties</li>
            </ul>
        </div>
    </div>
    
    <!-- Inline subscription widget for other pages -->
    <div class="newsletter-widget" id="newsletter-widget" style="display: none;">
        <div class="widget-content">
            <h4>Stay Updated</h4>
            <p>Get our latest posts delivered to your inbox.</p>
            <form class="widget-form" id="newsletter-widget-form">
                <div class="widget-input-group">
                    <input type="email" 
                           name="email" 
                           placeholder="Your email address" 
                           class="widget-input"
                           required>
                    <select name="frequency" class="widget-select">
                        <option value="weekly">Weekly</option>
                        <option value="bi-weekly">Bi-weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                    <button type="submit" class="widget-button">Subscribe</button>
                </div>
                <div class="widget-message" id="widget-message"></div>
            </form>
        </div>
    </div>
</div>

<script>
// AJAX subscription for widget
document.addEventListener('DOMContentLoaded', function() {
    const widgetForm = document.getElementById('newsletter-widget-form');
    const widgetMessage = document.getElementById('widget-message');
    
    if (widgetForm) {
        widgetForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const email = formData.get('email');
            const frequency = formData.get('frequency');
            
            // Show loading state
            const submitButton = this.querySelector('.widget-button');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Subscribing...';
            submitButton.disabled = true;
            
            fetch('{{ url_for("api_newsletter_subscribe") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('meta[name=csrf-token]').getAttribute('content')
                },
                body: JSON.stringify({
                    email: email,
                    frequency: frequency
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    widgetMessage.innerHTML = '<div class="success-message">' + data.message + '</div>';
                    widgetForm.reset();
                } else {
                    widgetMessage.innerHTML = '<div class="error-message">' + data.message + '</div>';
                }
            })
            .catch(error => {
                widgetMessage.innerHTML = '<div class="error-message">An error occurred. Please try again.</div>';
            })
            .finally(() => {
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            });
        });
    }
});
</script>
{% endblock %}